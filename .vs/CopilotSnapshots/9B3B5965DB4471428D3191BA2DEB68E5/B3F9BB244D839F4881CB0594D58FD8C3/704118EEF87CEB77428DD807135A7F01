@page "/login"
@using BabyPOS_Web.ViewModels
@inject HttpClient Http

@code {
    private LoginViewModel vm;
    protected override void OnInitialized()
    {
        vm = new LoginViewModel(Http);
    }
}

<h3>Login</h3>
<div>
    <label>Username</label>
    <input @bind="vm.Username" @oninput="OnUsernameInput" />
</div>
<div>
    <label>Password</label>
    <input type="password" @bind="vm.Password" @oninput="OnPasswordInput" />
</div>
<button @onclick="OnLogin">Login</button>

<div style="margin-top:12px">
    <NavLink href="/register">Register</NavLink>
</div>

@if (!string.IsNullOrEmpty(vm.ErrorMessage))
{
    <div style="color:red">@vm.ErrorMessage</div>
}
@if (vm.Token != null)
{
    <div style="color:green">Login Success! Token: @vm.Token</div>
}

@code {
    private void OnUsernameInput(ChangeEventArgs e)
    {
        var input = e.Value?.ToString() ?? string.Empty;
        // กรองให้เหลือเฉพาะ a-z, A-Z, 0-9
        vm.Username = System.Text.RegularExpressions.Regex.Replace(input, "[^a-zA-Z0-9]", "");
    }
    private void OnPasswordInput(ChangeEventArgs e)
    {
        var input = e.Value?.ToString() ?? string.Empty;
        vm.Password = System.Text.RegularExpressions.Regex.Replace(input, "[^a-zA-Z0-9]", "");
    }
    private async Task OnLogin()
    {
        // Validate password: only English letters and numbers
        if (string.IsNullOrEmpty(vm.Password) || !System.Text.RegularExpressions.Regex.IsMatch(vm.Password, "^[a-zA-Z0-9]+$"))
        {
            vm.ErrorMessage = "Password must contain only English letters and numbers.";
            vm.Password = string.Empty;
            return;
        }
        await vm.LoginAsync();
    }
}
